<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>JavaScript Robotics: Animation API (Johnny-Five)</title>
  <meta property="og:title" content="JavaScript Robotics: Animation API (Johnny-Five)">
  <meta property="og:url" content="http://johnny-five.io/api/animation">
    <meta property="og:site_name" content="Johnny-Five">
  <meta property="og:image" content="http://johnny-five.io/img/static/johnny-five-fb.png">
  <meta property="og:description" content="Johnny-Five is the original JavaScript Robotics &amp; IoT Platform. Released by Bocoup in 2012, Johnny-Five is maintained by a community of passionate software developers and hardware engineers. Over 75 developers have made contributions towards building a robust, extensible and composable ecosystem.">

  <meta name="description" content="Johnny-Five is the JavaScript Robotics &amp; IoT Platform , Animation">
  <meta name="keywords" content="JavaScript, Robotics , Animation">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="fonts" content="/css/type.css">


  <link rel="stylesheet" href="/css/styles.css?v1">
  <link rel="stylesheet" href="/css/anchor.css?v1">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css">

  <script src="/js/fontloader.js" id="fontloader"></script>
  <script src="/js/anchor.js" id="anchor.js"></script>
  <script src="/js/es6-shim.js" id="es6-shim.js"></script>

  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">

</head>
<body>

  <div class="mast">
    <nav class="nav-primary wrapper icon-j5">
            <a href="/">
        <img src="/img/j5-logo.svg" class="j5-icon">
      </a>

      <div class="navlist">
        <a href="/news/">News</a>
        <a href="/api/">API</a>
        <a href="/examples/">Examples</a>
        <a href="/articles/">Articles</a>
        <a href="/platform-support/" class="link-display-full">Platform Support</a>
        <a href="/platform-support/" class="link-display-short">Platforms</a>
      </div>


    </nav>

    <header role="banner" class="banner">
     <h1 class="site-hed"><span>Animation</span></h1>
    </header>
  </div>

  <main class="central docs">
    <div class="wrap-a wrap-docs list-docs">
      <nav id="api-nav" class="docs-nav api-nav-list api-content-view">
        <h3>Component Classes</h3>
        <ul>
<li><a href="/api/accelerometer/">Accelerometer</a></li>
<li><a href="/api/altimeter/">Altimeter</a></li>
<li><a href="/api/animation/">Animation</a></li>
<li><a href="/api/barometer/">Barometer</a></li>
<li><a href="/api/board/">Board</a></li>
<li><a href="/api/boards/">Boards</a></li>
<li><a href="/api/button/">Button</a></li>
<li><a href="/api/compass/">Compass</a></li>
<li><a href="/api/esc/">ESC</a></li>
<li><a href="/api/escs/">ESCs</a></li>
<li><a href="/api/expander/">Expander</a></li>
<li><a href="/api/fn/">Fn</a></li>
<li><a href="/api/gps/">GPS</a></li>
<li><a href="/api/gyro/">Gyro</a></li>
<li><a href="/api/hygrometer/">Hygrometer</a></li>
<li><a href="/api/imu/">IMU</a></li>
<li><a href="/api/ir.reflect.array/">IR.Reflect.Array</a></li>
<li><a href="/api/joystick/">Joystick</a></li>
<li><a href="/api/keypad/">Keypad</a></li>
<li><a href="/api/lcd/">LCD</a></li>
<li><a href="/api/led/">Led</a></li>
<li><a href="/api/led.digits/">Led.Digits</a></li>
<li><a href="/api/led.matrix/">Led.Matrix</a></li>
<li><a href="/api/led.rgb/">Led.RGB</a></li>
<li><a href="/api/leds/">Leds</a></li>
<li><a href="/api/light/">Light</a></li>
<li><a href="/api/motion/">Motion</a></li>
<li><a href="/api/motor/">Motor</a></li>
<li><a href="/api/motors/">Motors</a></li>
<li><a href="/api/multi/">Multi</a></li>
<li><a href="/api/piezo/">Piezo</a></li>
<li><a href="/api/pin/">Pin</a></li>
<li><a href="/api/proximity/">Proximity</a></li>
<li><a href="/api/relay/">Relay</a></li>
<li><a href="/api/relays/">Relays</a></li>
<li><a href="/api/sensor/">Sensor</a></li>
<li><a href="/api/servo/">Servo</a></li>
<li><a href="/api/servos/">Servos</a></li>
<li><a href="/api/shiftregister/">ShiftRegister</a></li>
<li><a href="/api/stepper/">Stepper</a></li>
<li><a href="/api/switch/">Switch</a></li>
<li><a href="/api/thermometer/">Thermometer</a></li>
</ul>

      </nav>

      <div class="docs-content api-content-view">
        <ul class="api-anchors">
          <li><a href="#parameters">Parameters</a></li>
          <li><a href="#shape">Shape</a></li>
          <li><a href="#component-initialization">Component Initialization</a>
          <li><a href="#usage">Usage</a></li>
          <li><a href="#api">API</a></li>
          <li><a href="#events">Events</a></li>
        </ul>

        <p>The <code>Animation</code> class constructs objects that represent a single Animation. An Animation consists of a target and an array of segments.
A <strong>target</strong> is the device or list of devices that are being animated.</p>
<p>A <strong>segment</strong> is a short modular animation sequence (i.e. sit, stand, walk, etc). Segments are synchronous and run first-in, first-out.</p>
<p>Things that can be animated:</p>
<ul>
<li><code>Servo</code>, <code>Servos</code></li>
<li><code>Led</code>, <code>Leds</code></li>
<li><code>Led.RGB</code>, <code>Led.RGBs</code></li>
</ul>
<p>You should be familiar with the API of the device(s) you will be animating. You don't have to call the device methods directly but if you haven't used them before this will be frustrating.</p>
<h3>Parameters</h3>
<ul>
<li><p><strong>target</strong> A <code>Servo</code>, <code>Servo.Array (Servos)</code> or list of devices. Optional, but if not passed here it must be passed as a property of each animation segment.</p>
<pre><code class="language-js">// Animate a single servo instance
var servo = new five.Servo(9);
var animation = new five.Animation(servo);
</code></pre>
<pre><code class="language-js">// Independently animate the servos in a Servo.Array
var servos = new five.Servos([9,10,11]);
var animation = new five.Animation(servos);
</code></pre>
<pre><code class="language-js">// Animate a Servo and Servo.Array. When passed as the member of an array, the 
// Servo.Array will be passed the same value for all devices in the Servo.Array
var servo = new five.Servo(9);
var servos = new five.Servos([10,11]);
var animation = new five.Animation([servo, servos]);
</code></pre></li>
</ul>
<h3>Usage</h3>
<p>A single Servo</p>
<pre><code class="language-js">var five = require(&quot;johnny-five&quot;);
var board = new five.Board();

board.on(&quot;ready&quot;, function() {
  var servo = new five.Servo(9);
  var animation = new five.Animation(servo);

  // Create an animation segment object
  animation.enqueue({
    duration: 2000,
    cuePoints: [0, 0.25, 0.5, 0.75, 1.0],
    keyFrames: [ {degrees: 0}, {degrees: 135}, {degrees: 45}, {degrees: 180}, {degrees: 0}]
  });
});
</code></pre>
<p>A Servo array</p>
<pre><code class="language-js">var five = require(&quot;johnny-five&quot;);
var board = new five.Board();

board.on(&quot;ready&quot;, function() {
  var servos = new five.Servos([9, 10, 11]);
  var animation = new five.Animation(servos);

  // Create an animation segment object
  animation.enqueue({
    duration: 2000,
    cuePoints: [0, 0.5, 1.0],
    keyFrames: [ 
      [{degrees: 0}, {degrees: 135}, {degrees: 180}],
      [{degrees: 0}, {degrees: 90}, {degrees: 180}],
      [{degrees: 0}, {degrees: 45}, {degrees: 180}]
    ]
  });
});
</code></pre>
<h2>API</h2>
<ul>
<li><p><strong>enqueue(segment object)</strong> Add a segment to the animation's queue. See the list of available segment properties below.</p>
<pre><code class="language-js">var five = require(&quot;johnny-five&quot;);
var board = new five.Board();

board.on(&quot;ready&quot;, function() {
  var servo = new five.Servo(9);
  var animation = new five.Animation(servo);

  // Create an animation object
  animation.enqueue({
    duration: 2000,
    cuePoints: [0, 0.25, 0.5, 0.75, 1.0],
    keyFrames: [ {degrees: 0}, {degrees: 135}, {degrees: 45}, {degrees: 180}, {degrees: 0}]
  });
});
</code></pre></li>
<li><p><strong>play()</strong> Play the animation. Animation's are set to play by default and this only needs to be called if the animation has been paused or a segment's speed property was set to 0.</p></li>
<li><p><strong>pause()</strong> Pause an animation while retaining the current progress and segment queue.</p></li>
<li><p><strong>stop()</strong> Immediately stop the animation and flush the segment queue.</p></li>
<li><p><strong>next()</strong> Jump to the next segment in the queue. This is called automatically when a segment completes and in most cases should not be called by the user.</p></li>
<li><p><strong>speed([Number speed])</strong> Set the currentSpeed of the animation. If no value is passed, the currentSpeed is returned.</p></li>
</ul>
<h2>Segment Properties</h2>
<ul>
<li><strong>target</strong>: Overrides the target passed when the Animation was created</li>
<li><strong>duration</strong>: Duration of the segment in milliseconds (default 1000)</li>
<li><strong>cuePoints</strong>: Array of values from 0.0 to 1.0 representing the beginning and end of the animation respectively (default [0, 1])</li>
<li><strong>keyFrames</strong>: A 1 or 2 dimensional array of device positions over time. See more on keyFrames below. (required)</li>
<li><strong>easing</strong>: An easing function from ease-component to apply to the playback head on the timeline. See the <a href="https://www.npmjs.org/package/ease-component">ease-component docs</a> for a list of available easing functions (default: &quot;linear&quot;)</li>
<li><strong>loop</strong>: When true, segment will loop until animation.next() or animation.stop() is called (default: false)</li>
<li><strong>loopback</strong>: The cuePoint that the animation will loop back to. If the animation is playing in reverse, this is the point at which the animation will &quot;loop back&quot; to 1.0 (default: 0.0)</li>
<li><strong>metronomic</strong>: Will play to cuePoint[1] then play in reverse to cuePoint[0]. If the segment is set to loop then the animation will play back and forth until next(), pause() or stop() are called (default: false)</li>
<li><strong>progress</strong>: The starting point for the playback head (default 0.0)</li>
<li><strong>currentSpeed</strong>: Controls the speed of the playback head and scales the calculated duration of this and all subsequent segments until it is changed by another segment or a call to the speed() method (default: 1.0)</li>
<li><strong>fps</strong>: The maximum frames per second for the segment (default: 60)</li>
<li><strong>onstart</strong>: function to execute when segment is started (default: none)</li>
<li><strong>onpause</strong>: function to execute when segment is paused (default: none)</li>
<li><strong>onstop</strong>: function to execute when animation is stopped (default: none)</li>
<li><strong>oncomplete</strong>: function to execute when segment is completed (default: none)</li>
<li><strong>onloop</strong>: function to execute when segment loops (default: none)</li>
</ul>
<h2>keyFrame Arrays</h2>
<p>If a single device is being animated, keyFrames may be a single dimensional array. If more than one device is being animated it must be 2-dimensional (an array of arrays). We call this a &quot;keyFrame set&quot;. The index of each device in the target maps to the same index in a keyFrame set so the length of the two should be identical.</p>
<p>Each keyFrame array should have an element that maps to each cue point in the cuePoints array. keyFrames[0][0] for example represents the position of the first device in your animation target at the first cuePoint. These may or may not be the same length. If there are fewer elements in a keyFrame array than in the cuePoints array, then the keyFrame array will be right padded with null values.</p>
<p>Elements in a keyFrame array represent a device's position at the corresponding cuePoint. Positions can be described in a number of ways:</p>
<h4>A Number</h4>
<p>This is a step in degrees from the previous cuePoint's position.</p>
<pre><code>// servo.last.degrees === 90
... cuePoints: [0, 0.25, 0.5, 0.75, 1], keyFrames : [ -45, 90, -135, 20, 70 ], ...
</code></pre>
<p><img src="https://raw.githubusercontent.com/rwaldron/johnny-five/master/assets/Animation-Graph(1).png" alt="keyFrames as a number"></p>
<h4>null</h4>
<p>The behavior of null varies depending upon its position in the array. If used in the first position, it will adopt the device's current value at the time the animation segment is played.</p>
<pre><code>// servo.last.degrees === 90
... cuePoints: [0, 0.25, 0.5, 0.75, 1], keyFrames : [ null, 90, -135, 20, 70 ], ...
</code></pre>
<p><img src="https://raw.githubusercontent.com/rwaldron/johnny-five/master/assets/Animation-Graph(2).png" alt="null at beginning"></p>
<hr>
<p>If used at the end of the array it will copy the previous known value.</p>
<pre><code>// servo.last.degrees === 90
... cuePoints: [0, 0.25, 0.5, 0.75, 1], keyFrames : [ -45, 90, -135, 20, null ], ...
</code></pre>
<p><img src="https://raw.githubusercontent.com/rwaldron/johnny-five/master/assets/Animation-Graph(3).png" alt="null at end"></p>
<hr>
<p>If used between two keyFrames this cuePoint will be ignored for this device and the value will be a tween of the previous and next known values.</p>
<pre><code>// servo.last.degrees === 90
... cuePoints: [0, 0.25, 0.5, 0.75, 1], keyFrames : [ -45, 90, null, 20, -155 ], ...
</code></pre>
<p><img src="https://raw.githubusercontent.com/rwaldron/johnny-five/master/assets/Animation-Graph(4).png" alt="null in middle"></p>
<h4>false</h4>
<p>Will copy the previous known value (don't move the device)</p>
<pre><code>// servo.last.degrees === 90
... cuePoints: [0, 0.25, 0.5, 0.75, 1], keyFrames : [ -45, 90, false, 20, -155 ], ...
</code></pre>
<p><img src="https://raw.githubusercontent.com/rwaldron/johnny-five/master/assets/Animation-Graph(5).png" alt="false as a keyFrame"></p>
<h4>A keyFrame object</h4>
<p>The available properties for keyFrame objects are:</p>
<p><strong>step</strong>: A step in degrees from the previous cuePoint position.</p>
<pre><code>// servo.last.degrees === 90
... cuePoints: [0, 0.25, 0.5, 0.75, 1], keyFrames : [ -45, {step: 90}, -135, 20, 70 ], ...
</code></pre>
<p><img src="https://raw.githubusercontent.com/rwaldron/johnny-five/master/assets/Animation-Graph(1).png" alt="step property"></p>
<p><strong>degrees</strong>: The servo position in degrees.</p>
<pre><code>// servo.last.degrees === 90
... cuePoints: [0, 0.25, 0.5, 0.75, 1], keyFrames : [ -45, {degrees: 180}, -135, 20, 70 ], ...
</code></pre>
<p><img src="https://raw.githubusercontent.com/rwaldron/johnny-five/master/assets/Animation-Graph(6).png" alt="degrees property"></p>
<p><strong>easing</strong>: An easing function from ease-component to apply to the tweened value of the previous and next keyFrames. See the <a href="https://www.npmjs.org/package/ease-component">ease-component docs</a> for a list of available easing functions (default: &quot;linear&quot;)</p>
<pre><code>// servo.last.degrees === 90
... cuePoints: [0, 0.25, 0.5, 0.75, 1], keyFrames : [ -45, {degrees: 180, easing: &quot;inOutCirc&quot;, -135, 20, 70 ], ...
</code></pre>
<p><img src="https://raw.githubusercontent.com/rwaldron/johnny-five/master/assets/Animation-Graph(7).png" alt="easing property"></p>
<p><strong>copyDegrees</strong>: An index from this keyFrames array from which we copy the calculated or explicitly set degrees value.</p>
<pre><code>// servo.last.degrees === 90
... cuePoints: [0, 0.25, 0.5, 0.75, 1], keyFrames : [ -45, 90, -135, { copyDegrees: 1 }, -45 ], ...
</code></pre>
<p><img src="https://raw.githubusercontent.com/rwaldron/johnny-five/master/assets/Animation-Graph(8).png" alt="copyDegrees property"></p>
<p><strong>copyFrame</strong>: An index from this keyFrames array from which we copy all of the properties.</p>
<pre><code>// servo.last.degrees === 90
... cuePoints: [0, 0.25, 0.5, 0.75, 1], keyFrames : [ -45, 90, -135, { copyFrame: 1 }, 70 ], ...
</code></pre>
<p><img src="https://raw.githubusercontent.com/rwaldron/johnny-five/master/assets/Animation-Graph(9).png" alt="copyFrame property"></p>
<p><strong>position</strong>: A two or three tuple defining a coordinate in 2d or 3d space.</p>
<pre><code>// two-tuple
...  cuePoints: [0, 0.5, 1], keyFrames : [ { position: [10, 10 ] }, { position: [20, 50 ] }, { position: [10, 10 ] } ] ...

// three-tuple
...  cuePoints: [0, 0.5, 1], keyFrames : [ { position: [10, 10, 0 ] }, { position: [20, 50, 90 ] }, { position: [10, 10, 0 ] } ] ...
</code></pre>
<h2>Additional Tips</h2>
<ul>
<li>Use the servos' isInverted property to keep movements on the left and right side moving in the same direction when passed the same value.</li>
<li>Use the servos' offset property so that 90 degrees on one is the same as 90 degrees on corresponding servos.</li>
<li>Divide animations into small reusable components. These will be your segments.</li>
<li>Use onstop functions when your looping animation is halted to return a bot's animated limbs to their home positions. In other words, when an animation stops make sure your bot is ready for the next segment, whatever it may be.</li>
<li>Use loopback properties to give you a place for prep moves that occur before a looping segment. For example, when walking the first step is half the size of the looping steps.</li>
<li>Nearly always use null as the first value in an animation segment. It allows the segment to be started from a variety of positions.</li>
<li>For most walking bots a step cannot be accomplished by turning a single servo. Joints must work together to keep your end effector (foot) in a stable position on the floor. Turning a single servo will force effectors to work against each other and make your robot look clumsy.</li>
<li>Use an easing function on your segments. It gives your bot more natural movement.</li>
<li>Easing functions can be applied to the segment timeline AND keyframes. They are additive. Experiment with this.</li>
<li>Avoid having your end effector impact the ground with significant force. Doing so will eventually strip your servo gears.</li>
</ul>
<p><a href="https://en.wikipedia.org/wiki/Key_frame">&quot;Key frames&quot; on Wikipedia</a></p>



        <h2>Examples</h2>
<ul>
<li><a href="/examples/led-pulse-animation">LED - Pulse with animation</a></li>
<li><a href="/examples/led-fade-animation">LED - Fade with animation</a></li>
<li><a href="/examples/servo-animation">Servo - Animation</a></li>
<li><a href="/examples/servo-animation-leg">Servo - Leg Animation</a></li>
<li><a href="/examples/phoenix">Phoenix Hexapod</a></li>
</ul>

      </div>
    </div>
  </main>

    <div class="bmast">
    <div class="bmast-central">
      <div class="enews-intro">
        <p>Hi! The Johnny-Five community is building new projects every day. We made this newsletter to tell you about what's new, what's good, and what's next for Open Source robotics. Join us in exploring what we can make together.</p>
      </div>

      <div class="enews-signup">
        <!-- Begin MailChimp Signup Form -->
        <div id="mc_embed_signup">
          <form action="//johnny-five.us1.list-manage.com/subscribe/post?u=118da1f399c6a18b75e6972ee&amp;id=b0bf5cc6c2" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
              <div id="mc_embed_signup_scroll">
              <label for="mce-EMAIL">Email Address</label>
              <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="Your email address" required>
              <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
              <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_118da1f399c6a18b75e6972ee_b0bf5cc6c2" tabindex="-1" value=""></div>
              <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
              </div>
          </form>
        </div>
        <!--End mc_embed_signup-->
      </div>
    </div>
  </div>

  <a href="https://github.com/rwaldron/johnny-five">
    <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/52760788cde945287fbb584134c4cbc2bc36f904/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f77686974655f6666666666662e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" class="fork-me">
  </a>

  <footer>
    <div class="created-at-bocoup">

      <a href="http://bocoup.com">
        <img src="/img/bocoup-bob.png">
      </a>

    </div>
    <div class="social">

      <a href="https://github.com/rwaldron/johnny-five" class="github-icon"><img src="/img/github-icon.png"></a>

      <a href="https://www.youtube.com/results?search_query=nodebots" class="yt-icon"><img src="/img/yt-icon.png"></a>
      <a href="https://twitter.com/rwaldron/lists/nodebotics" class="twitter-icon"><img src="/img/twitter-icon.png"></a>
    </div>
  </footer>
  <script src="/js/platform-data.js"></script>
  <script src="/js/main.js"></script>
  <script src="/js/konami.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-61698621-1', 'auto');
    ga('send', 'pageview');
  </script>


</body>
</html>
