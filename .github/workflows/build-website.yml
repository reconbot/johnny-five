name: Build Website

on:
- push:
  branches: 
    - master
- gollum

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout
      with:
        repository: nodebots/johnny-five.io
        ref: master
    - name: Use Node.js 10.x
      uses: actions/setup-node@v1
      with:
        version: 10.x
    - name: npm install, build, and test
      run: |
        npm ci
        npm run build
    - name: 👍 THE SITE IS BUILT—PUSHING IT BACK TO GITHUB-PAGES
      run: |
        cd public
        export remote_repo="https://${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git"
        export remote_branch="gh-pages"
        echo -n 'Files to Commit:' && find . -type f | wc -l
        git init
        git config user.name "${GITHUB_ACTOR}"
        git config user.email "${GITHUB_ACTOR}@users.noreply.github.com"
        git add .
        git commit -m 'website build' > /dev/null
        git push --force $remote_repo master:$remote_branch > /dev/null
        echo '👍 GREAT SUCCESS!'
